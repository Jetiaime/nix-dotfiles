vmType: "vz"

rosetta:
  enabled: true
  binfmt: true


images:
  - location: "https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-genericcloud-arm64.qcow2"
    arch: "aarch64"

arch: "aarch64"
cpus: 8
memory: "16GiB"
disk: "250GiB"

mounts:
  - location: "~"
    writable: true

portForwards:
  - guestSocket: "/var/run/docker.sock"
    hostSocket: "{{.Dir}}/sock/docker.sock"
  - guestPort: 6443
    hostPort: 6443
  - guestPort: 80
    hostPort: 8080
  - guestPort: 443
    hostPort: 8443


containerd:
  system: false
  user: false

provision:
  - mode: system
    script: |
      #!/bin/bash
      set -eux -o pipefail
      
      export DEBIAN_FRONTEND=noninteractive
      apt-get update
      apt-get install -y curl
      
      # 安装 Docker
      curl -fsSL https://get.docker.com | sh
      systemctl enable docker
      systemctl start docker
      
      # 安装 Kind（ARM64 版本）
      curl -Lo /usr/local/bin/kind https://kind.sigs.k8s.io/dl/v0.24.0/kind-linux-arm64
      chmod +x /usr/local/bin/kind
      
      # 安装 kubectl（ARM64 版本）
      curl -Lo /usr/local/bin/kubectl https://storage.googleapis.com/kubernetes-release/release/v1.31.0/bin/linux/arm64/kubectl
      chmod +x /usr/local/bin/kubectl
      
  - mode: user
    script: |
      #!/bin/bash
      set -eux -o pipefail
      
      # 添加用户到 docker 组
      sudo usermod -aG docker $(whoami)
